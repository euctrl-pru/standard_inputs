<script>
document.addEventListener("DOMContentLoaded", function () {
  console.log("🔁 Rewriting version links...");

  const path = window.location.pathname;
  const hash = window.location.hash;
  
  console.log("path: ",  path);
  console.log("hash: ",  hash);
  
  // Try to extract the version from the pathname first
  let versionMatch = path.match(/\/(v\d+\.\d+\.\d+|latest)\//);
  
  // Fallback to hash if no version in path
  if (!versionMatch && hash.startsWith('#VERSION:')) {
    versionMatch = [null, hash.replace('#VERSION:', '')];
  }

  if (!versionMatch) {
    console.warn("⚠️ No version match found in path or hash.");
    return;
  }

  const currentVersion = versionMatch[1]; // "v10.0.3" or "latest"
  const currentPage = path === '/' ? '/index.html' : path;
  const base = ''; // Assume root, since path is just `/`

  document.querySelectorAll('a[href^="#VERSION:"]').forEach(link => {
    const targetVersion = link.getAttribute("href").replace("#VERSION:", "");
    const newHref = `${base}/${targetVersion}${currentPage}`;
    console.log(`🔗 Rewriting link to ${newHref}`);
    link.setAttribute("href", newHref);
  });
});
</script>
