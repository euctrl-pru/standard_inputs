<script>
document.addEventListener("DOMContentLoaded", function () {
  console.log("üîÅ Rewriting version links...");
  const path = window.location.pathname;

  // Match `/v10.0.3/` or `/latest/`
  const versionMatch = path.match(/\/(v\d+\.\d+\.\d+|latest)\//);
  if (!versionMatch) {
    console.warn("‚ö†Ô∏è Could not find version in path:", path);
    return;
  }

  const currentVersion = versionMatch[1]; // "v10.0.3", "latest"
  const currentPage = path.split(`/${currentVersion}/`)[1] || '/index.html';
  const base = path.split(`/${currentVersion}/`)[0];

  let tries = 0;
  const maxTries = 10;

  function tryRewriteLinks() {
    const links = document.querySelectorAll('a[href^="#VERSION:"]');
    if (links.length === 0 && tries < maxTries) {
      tries++;
      console.log(`‚è≥ Attempt ${tries}: No matching links found yet. Retrying...`);
      setTimeout(tryRewriteLinks, 100);
      return;
    }

    links.forEach(link => {
      const targetVersion = link.getAttribute("href").replace("#VERSION:", "");
      const newHref = `${base}/${targetVersion}${currentPage}`;
      console.log(`üîó Rewriting link to ${newHref}`);
      link.setAttribute("href", newHref);
      console.log("targetVersion: ", targetVersion);
      console.log("newHref: ", newHref);
    });
  }

  tryRewriteLinks();
});
</script>
